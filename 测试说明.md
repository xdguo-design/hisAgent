# 文档添加功能测试说明

## 问题诊断

从服务器日志分析发现：
- 用户直接点击"添加文档到知识库"按钮
- 没有先点击"选择文件"或"选择文件夹"来上传文件
- uploads目录一直是空的
- 服务器返回400错误："在上传目录中没有找到文件"

## 正确的使用步骤

### 步骤1：上传文档
1. 打开"添加文档"对话框
2. 点击蓝色按钮"选择文件"（单个文件）或绿色按钮"选择文件夹"（整个文件夹）
3. 在弹出的文件选择对话框中选择要上传的文件
4. 等待文件上传完成，看到"文件上传成功"提示

### 步骤2：查看已上传文件
1. 在"步骤2：已上传文件"区域查看上传的文件列表
2. 确认文件数量大于0
3. 如果不需要某个文件，可以点击红色的"×"按钮删除

### 步骤3：配置参数（可选）
1. 设置分块大小（默认512）
2. 设置分块重叠（默认50）
3. 选择嵌入模型（可选，不指定则使用知识库原有模型）

### 步骤4：添加文档到知识库
1. 点击"步骤 4: 添加文档到知识库"按钮
2. 等待处理完成
3. 看到"文档添加成功"提示

## UI改进说明

- ✅ 添加步骤标记（步骤1、步骤2、步骤3、步骤4）
- ✅ 添加黄色警告提示：当没有上传文件时，明确提示"请先完成步骤1和步骤2"
- ✅ 按钮状态管理：处理中时禁用所有按钮
- ✅ 文件大小限制：50MB，防止内存溢出
- ✅ 详细日志：浏览器控制台显示上传进度

## 测试文件

已创建测试文件 `test_upload.txt`，可用于测试上传功能。

## 支持的文件格式

- .txt - 文本文件
- .md - Markdown文件
- .pdf - PDF文档
- .docx - Word文档
- .doc - 旧版Word文档
- .html - HTML文件
- .json - JSON文件
- .java - Java源代码文件

## 常见错误及解决方法

### 错误1：400错误 - "在上传目录中没有找到文件"
**原因**：没有先上传文件就点击了"添加文档到知识库"
**解决**：先完成步骤1和步骤2，看到已上传文件列表后再点击步骤4

### 错误2：400错误 - "没有有效的文件（单个文件不能超过50MB）"
**原因**：上传的文件过大
**解决**：压缩文件或拆分成多个小文件上传

### 错误3：400错误 - "不支持的文件类型"
**原因**：上传了不支持格式的文件
**解决**：只上传支持格式的文件（见上方列表）

## 调试方法

如果遇到问题，请：
1. 打开浏览器开发者工具（F12）
2. 切换到"Console"标签
3. 查看详细的日志输出
4. 将日志信息分享给开发者

## 服务器日志位置

服务器日志会在终端中显示，包含：
- 请求开始/结束时间
- 请求路径和方法
- 文件上传进度
- 文档添加进度
- 错误信息和堆栈跟踪